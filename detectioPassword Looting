index="test" sourcetype="kunai_json"
(
    data.command_line="*cat /etc/shadow*"
    OR data.command_line="*unshadow*"
    OR data.command_line="*john*"
    OR data.command_line="*hashcat*"
    OR data.command_line="*openssl passwd*"
    OR data.command_line="*pam_unix*"
)
| stats 
    count AS nb_events
    values(data.command_line) AS cmds
    min(_time) AS firstTime
    max(_time) AS lastTime
  BY info.host.name info.task.user
| eval firstTime=strftime(firstTime,"%Y-%m-%d %H:%M:%S"),
       lastTime=strftime(lastTime,"%Y-%m-%d %H:%M:%S")
| rename info.host.name AS host,
         info.task.user AS user
| eval alert_title="Password looting Linux",
       alert_description="Exécution de commandes de récupération de mots de passe / hashes (cat /etc/shadow, john, hashcat, openssl passwd, etc.)",
       alert_source_event_time=strftime(lastTime,"%Y-%m-%d %H:%M:%S"),
       alert_source="kunai_json",
       alert_severity_id=4,
       alert_source_content=mvjoin(cmds, "\n")
| table host alert_title alert_description alert_source alert_source_event_time alert_severity_id alert_source_content
